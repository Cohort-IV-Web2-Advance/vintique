<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Orders — Vintique</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/src/style.css" />
</head>
<body class="bg-cream font-sans text-darkbrown">

  <!-- NAVBAR -->
  <nav class="sticky top-0 z-50 bg-cream/95 backdrop-blur-sm border-b border-parchment shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between py-2">
         <img src="/image/836230a2-2ca2-471b-b559-c79b56e9cd14.jpeg" alt="logo" class="h-16 rounded-full">
      <a href="index.html" class="font-serif text-2xl font-bold text-brown">Vintique</a>
      <div class="flex items-center gap-4">
        <a href="products.html" class="text-sm text-brown hover:text-amber transition-colors hidden md:block">Shop</a>
        <button onclick="logout()" class="text-sm text-muted hover:text-rust transition-colors hidden md:block">Sign Out</button>
        <a href="cart.html" class="relative p-2 text-brown hover:text-amber transition-colors">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6" stroke-width="1.8"/><path stroke-linecap="round" stroke-linejoin="round" d="M16 10a4 4 0 01-8 0"/></svg>
          <span id="cart-count" class="absolute -top-0.5 -right-0.5 bg-rust text-white text-[10px] font-bold rounded-full w-4 h-4 flex items-center justify-center">0</span>
        </a>
      </div>
    </div>
  </nav>

  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="flex items-end justify-between mb-10">
      <div>
        <p class="text-amber text-xs tracking-[0.3em] uppercase font-sans mb-2">Account</p>
        <h1 class="font-serif text-4xl text-brown">My Orders</h1>
      </div>
      <div id="user-greeting" class="hidden md:block text-right">
        <p class="text-xs text-muted font-sans">Signed in as</p>
        <p class="text-sm text-brown font-semibold" id="user-name"></p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex gap-1 bg-parchment/50 p-1 rounded-xl mb-8 w-fit">
      <button onclick="filterOrders('all')" id="tab-all"
        class="order-tab px-5 py-2 text-sm font-sans rounded-lg bg-white text-brown font-semibold shadow-sm transition-all">
        All Orders
      </button>
      <button onclick="filterOrders('pending')" id="tab-pending"
        class="order-tab px-5 py-2 text-sm font-sans rounded-lg text-muted hover:text-brown transition-all">
        Pending
      </button>
      <button onclick="filterOrders('shipped')" id="tab-shipped"
        class="order-tab px-5 py-2 text-sm font-sans rounded-lg text-muted hover:text-brown transition-all">
        Shipped
      </button>
      <button onclick="filterOrders('delivered')" id="tab-delivered"
        class="order-tab px-5 py-2 text-sm font-sans rounded-lg text-muted hover:text-brown transition-all">
        Delivered
      </button>
    </div>

    <!-- Orders List -->
    <div id="orders-list" class="space-y-4">
      <div class="skeleton h-28 rounded-2xl"></div>
      <div class="skeleton h-28 rounded-2xl"></div>
      <div class="skeleton h-28 rounded-2xl"></div>
    </div>

    <!-- Empty -->
    <div id="orders-empty" class="hidden text-center py-20">
      <p class="font-serif text-3xl text-muted mb-3">No orders yet</p>
      <p class="text-sm text-muted mb-6">Your purchased items will appear here.</p>
      <a href="products.html" class="inline-block bg-amber hover:bg-rust text-cream font-sans font-semibold text-sm px-8 py-3 rounded-xl transition-colors">
        Browse the Collection
      </a>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-6 right-6 z-50 hidden">
    <div class="bg-brown text-cream px-5 py-3 rounded-xl shadow-2xl flex items-center gap-3 text-sm font-sans">
      <span class="text-amber">✓</span><span id="toast-msg"></span>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script>
    // Mock orders for demo
    const MOCK_ORDERS = [
      { id: 1001, product: { name: "Victorian Cameo Brooch", image_url: "https://images.unsplash.com/photo-1602751584552-8ba73aad10e1?w=200&q=80" }, quantity: 1, unit_price: 89.99, amount: 89.99, order_status: "delivered", created_at: "2025-11-12T10:30:00Z" },
      { id: 1002, product: { name: "Amber Bakelite Necklace", image_url: "https://images.unsplash.com/photo-1611085583191-a3b181a88401?w=200&q=80" }, quantity: 1, unit_price: 72.00, amount: 72.00, order_status: "shipped", created_at: "2025-12-01T14:00:00Z" },
      { id: 1003, product: { name: "1950s Leather Satchel", image_url: "https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=200&q=80" }, quantity: 1, unit_price: 210.00, amount: 210.00, order_status: "pending", created_at: "2025-12-15T09:15:00Z" },
    ];

    const STATUS_STYLES = {
      pending:   'bg-amber/10 text-amber',
      processing: 'bg-blue-50 text-blue-600',
      shipped:   'bg-sage/10 text-sage',
      delivered: 'bg-green-50 text-green-600',
      cancelled: 'bg-rust/10 text-rust',
    };

    let allOrders = [];
    let activeFilter = 'all';

    async function loadOrders() {
      const user = getUser();
      if (user) {
        document.getElementById('user-greeting')?.classList.remove('hidden');
        document.getElementById('user-name').textContent = user.username || user.email;
      }

      try {
        allOrders = await ordersAPI.history();
      } catch {
        allOrders = MOCK_ORDERS;
      }
      renderOrders();
    }

    function filterOrders(status) {
      activeFilter = status;
      document.querySelectorAll('.order-tab').forEach(t => {
        const isActive = t.id === `tab-${status}`;
        t.className = `order-tab px-5 py-2 text-sm font-sans rounded-lg transition-all ${isActive ? 'bg-white text-brown font-semibold shadow-sm' : 'text-muted hover:text-brown'}`;
      });
      renderOrders();
    }

    function renderOrders() {
      const list = document.getElementById('orders-list');
      const empty = document.getElementById('orders-empty');
      const filtered = activeFilter === 'all' ? allOrders : allOrders.filter(o => o.order_status === activeFilter);

      if (filtered.length === 0) {
        list.classList.add('hidden');
        empty.classList.remove('hidden');
        return;
      }

      list.classList.remove('hidden');
      empty.classList.add('hidden');

      list.innerHTML = filtered.map((o, i) => `
        <div class="bg-white rounded-2xl p-5 flex flex-col sm:flex-row gap-4 fade-in product-card" style="animation-delay:${i*0.06}s">
          <img src="${o.product?.image_url || ''}" alt="${o.product?.name || 'Product'}"
            class="w-20 h-20 object-cover rounded-xl flex-shrink-0"
            onerror="this.src='https://images.unsplash.com/photo-1558171813-a08ccd5e6b95?w=150&q=60'" />
          <div class="flex-1">
            <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-2">
              <div>
                <p class="font-serif text-lg text-brown font-semibold">${o.product?.name || 'Vintage Item'}</p>
                <p class="text-xs text-muted font-sans mt-0.5">Order #${o.id} · ${formatDate(o.created_at)}</p>
              </div>
              <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold font-sans capitalize w-fit ${STATUS_STYLES[o.order_status] || STATUS_STYLES.pending}">
                ${o.order_status}
              </span>
            </div>
            <div class="flex items-center justify-between mt-3 pt-3 border-t border-parchment">
              <p class="text-sm text-muted font-sans">Qty: <span class="text-brown font-semibold">${o.quantity}</span> · Unit: <span class="text-brown font-semibold">${formatPrice(o.unit_price)}</span></p>
              <p class="font-serif text-lg text-amber font-semibold">${formatPrice(o.amount)}</p>
            </div>
          </div>
        </div>
      `).join('');
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (!isLoggedIn()) { window.location.href = 'login.html'; return; }
      loadOrders();
    });
  </script>
</body>
</html>
